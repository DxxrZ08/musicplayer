<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MusicStream - Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/style.css">
  </head>
<body class="bg-slate-900 text-slate-100">
  <div class="app-shell">
    <aside class="sidebar">
      <div class="logo">
        <img src="https://via.placeholder.com/40/1DB954/ffffff?text=A" width="40" height="40" style="border-radius:6px;" alt="logo">
        <div>
          <div class="fw-bold">Admin â€” MusicStream</div>
          <div class="small muted">Administrator</div>
        </div>
      </div>
      <nav class="nav">
        <a href="admin-dashboard.html" class="active">Dashboard</a>
        <a href="admin-manage.html">Manage Songs</a>
        <a href="admin-upload.html">Uploads</a>
        <a href="admin-users.html">Users</a>
        <a href="admin-reports.html">Reports</a>
      </nav>
      <div style="flex:1"></div>
      <button id="adminLogoutBtn" class="btn btn-outline-danger w-100 mb-3" style="font-size:0.9rem;">Logout</button>
      <div class="small muted">Â© MusicStream</div>
    </aside>

    <main class="main">
      <div class="container py-5">
        <h3>Admin Dashboard</h3>
        <p class="text-muted">Overview and quick links for administrators.</p>

    <div class="row g-3 mt-3">
      <div class="col-md-4">
        <div class="p-3 glass">
          <small>Total songs</small>
          <div id="statTotal" class="fw-bold display-6">0</div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="p-3 glass">
          <small>Playlists</small>
          <div id="statPlaylists" class="fw-bold display-6">0</div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="p-3 glass">
          <small>ðŸ‘¥ Active Users (Live)</small>
          <div id="statUsers" class="fw-bold display-6">0</div>
        </div>
      </div>
    </div>

    <hr class="my-4">

    <div class="row">
      <div class="col-md-6">
        <h5>Recent uploads</h5>
        <div id="recentUploads" class="list-group mt-2"></div>
      </div>
      <div class="col-md-6">
        <h5>Login pages</h5>
        <p class="text-muted">Quick access to all login screens</p>
        <ul id="loginPages" class="list-group"></ul>
      </div>
    </div>
      </div>
    </main>

  <script>
    // Guard: require adminLoggedIn
    if (!sessionStorage.getItem('adminLoggedIn')) {
      window.location.href = 'admin-login.html';
    }

    // Populate dashboard stats from local/session storage where available
    (function(){
      try {
        const playlist = JSON.parse(sessionStorage.getItem('playlist') || '[]');
        document.getElementById('statTotal').textContent = playlist.length || 0;
      } catch(e){ document.getElementById('statTotal').textContent = '0'; }

      try {
        const pls = JSON.parse(localStorage.getItem('mb_playlists') || '[]');
        document.getElementById('statPlaylists').textContent = (pls && pls.length) || 0;
      } catch(e){ document.getElementById('statPlaylists').textContent = '0'; }

      try {
        const users = JSON.parse(localStorage.getItem('mb_users') || '[]');
        // Show active users instead
        const activeUsers = window.getActiveUsers ? window.getActiveUsers() : [];
        document.getElementById('statUsers').textContent = activeUsers.length || 0;
      } catch(e){ document.getElementById('statUsers').textContent = '0'; }

      // Auto-refresh active users count
      const refreshUserCount = ()=>{
        try {
          const activeUsers = window.getActiveUsers ? window.getActiveUsers() : [];
          document.getElementById('statUsers').textContent = activeUsers.length || 0;
        } catch(e){}
      };
      setInterval(refreshUserCount, 3000);

      // Recent uploads: show last 10 songs from playlist
      try {
        const recent = JSON.parse(sessionStorage.getItem('playlist') || '[]').slice(-10).reverse();
        const ul = document.getElementById('recentUploads');
        if(!recent.length) { ul.innerHTML = '<div class="text-muted small">No recent uploads</div>'; }
        else {
          ul.innerHTML = recent.map(s=>`<a href="#" class="list-group-item list-group-item-action"><div class="d-flex justify-content-between"><div><strong>${s.title}</strong><div class="small text-muted">${s.artist||'Unknown'}</div></div><small class="text-muted">${s.duration||''}</small></div></a>`).join('');
        }
      } catch(e){ console.warn(e); }

      // Login pages list (hard-coded common login pages)
      const loginPages = [
        {title:'User Login', href:'login.html'},
        {title:'Admin Login', href:'admin-login.html'},
      ];
      const lp = document.getElementById('loginPages');
      lp.innerHTML = loginPages.map(p=>`<li class="list-group-item"><a href="${p.href}">${p.title}</a></li>`).join('');

      // Logout handler
      const logoutBtn = document.getElementById('adminLogoutBtn');
      if(logoutBtn){
        logoutBtn.addEventListener('click', function(){
          sessionStorage.removeItem('adminLoggedIn');
          uiToast('Logged out', {type:'info'});
          setTimeout(()=>{ window.location.href = 'admin-login.html'; }, 500);
        });
      }
    })();
  </script>

  <!-- Auth check script - runs before page loads fully -->
  <script>
    (function(){
      if(!sessionStorage.getItem('adminLoggedIn')){
        window.location.href = 'admin-login.html';
      }
    })();
  </script>
  <script src="js/admin.js"></script>
  <script src="admin-inject.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
